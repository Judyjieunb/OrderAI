[PRD] 상품 속성 기반 유사 스타일 반환 모델 (Phase 1)

> Last Updated: 2025-01-28
> 


## 1. 프로젝트 개요

### 1.1 배경 및 목적

- **배경**
    - 현재 상품 기획 과정에서 유사한 스타일을 과거 상품 기준으로 빠르게 참고할 수 있는 도구가 부족하고, 단순 키워드 검색이나 필터링으로는 한계가 있음 
    (예: '패딩'과 '다운점퍼'를 다른 상품으로 인식)
    - 현업에서는 룸 레인지 구성 시 시즌/카테고리/아이템/소재/핏/가격대/기획 레이블링을 종합적으로 고려하나 DB화되어있지 않음
    - 브랜드별로 데이터 입력률 차이가 커서 단순 필터링 적용이 어려움
- **목적**
    - 상품 속성 데이터를 분석하여, 특정 상품과 가장 유사한 과거 상품 Top 3를 자동으로 반환하는 시스템 모델 구축
- **Phase 1 범위**
    - Phase 1에서는 텍스트/속성 기반 모델을 우선 구축
    - 향후 Phase 2에서 이미지(CAD) 기반 검색으로 고도화 예정

### 1.2 개발 범위

- **대상 브랜드:** MLB(M), Discovery(X), Sergio Tacchini(ST), Duvetica(V), 기타(I, W)
- **핵심 기능:**
    1. 브랜드 통합 유사도 분석 모델 구축 (Unified Model)
        - 동적 가중치 방식으로 브랜드별 속성 가용성 차이를 자동 보정
    2. 상품명 및 주요 속성(카테고리, 핏, 소재 등) 기반 유사도 산출
    3. 배치(Batch) 작업을 통한 결과 데이터 DB 적재 (실시간 추론 X)

---

## 2. 데이터 요구사항

### 2.1 학습 데이터 (Input Features)

마이크로 스펙(데니아, 밀도 등)은 노이즈 제거를 위해 배제하며, 스타일 결정 속성 위주로 구성함.

### ■ 하드필터링 속성 (검색 범위 제한)

| DB 컬럼명 | 설명 | 빈값률 | 비고 |  |
| --- | --- | --- | --- | --- |
| `PRDT_KIND_NM` | 중분류 | 0% | 완전일치 조건 |  |
| `SEX_NM` | 성별 | 0% | UNISEX↔남/여 매칭 허용 |  |
| `SESN_SUB_NM` | 시즌 | 0% | FW그룹(Fall↔Winter), SS그룹(Spring↔Summer) |  |

### ■ 공통 속성 (정밀 채점용 속성)

| DB 컬럼명 | 설명 | 빈값률 | 비고 |  |
| --- | --- | --- | --- | --- |
| `ITEM_NM_ENG` | 아이템명(영문) | 0% | Down Jumper, Sweatshirt 등 94개 |  → 영문/국문 컬럼 별도로 있는데 어떤게 성능에 유리할까요 |
| `SUB_CAT_NM` | 서브카테고리 | 0% | 반팔티, 볼캡, 맨투맨 등 155개 |  |
| `TAG_PRICE` | 판매가 | 0% | 가격대 범주화 필요 |  |
| `PRDT_NM` | 상품명 | 0% | 텍스트 유사도 계산 |  |

### ■ 의류 전용 속성 (값 있을 때만 계산)

| DB 컬럼명 | 설명 | 빈값률 | 비고 |  |
| --- | --- | --- | --- | --- |
| `FAB_TYPE_NM` | 소재타입 | 0% | KNIT, WOVEN, SWEATER 등 |  |
| `FIT_INFO1` | 핏 | 7.4% | Over, Slim, Wide 등 33개 |  |
| `DOMAIN1_NM` | 그래픽/디자인 | 0% | Basic, Monogram, Varsity 등 18개 |  |
| `~~LENGTH_NM~~` | 기장 | 92.7% | Crop, Short, Mid, Long | 다운특화 |
| `~~WEIGHT_NM~~` | 중량 | 86.2% | Light, Medium, Heavy | 다운특화 |

### ■ ACC 전용 속성 (값 있을 때만 계산)

| DB 컬럼명 | 설명 | 빈값률 | 비고 |  |
| --- | --- | --- | --- | --- |
| `SHAPE1_USR` | 형태 | 68.7% | RUNNER, HOBO BAG 등 (MLB 위주) | 용품은 거의 MLB특화, MLB는 거의 모든 값 있지만 타브랜드는 거의 없음  |
| `SESN_USR` | 소재/시리즈 | 71.9% | CURVE RUNNER, PU, Cotton 등 |  |
| `FIT_INFO1` | 핏 (Headwear) | 69.1% | D Fit, W Fit 등 |  |
| `DOMAIN1_NM` | 그래픽/디자인 | 0% | Basic, Monogram 등 12개 |  |

### 2.2 전처리 규칙

- **상품명:** 특수문자(`[]`, `()`, `_`) 제거 후 명사 단위 토큰화 (KoNLPy 등 활용 권장)
- **베딩 처리:** 사전에 학습된 한국어 모델(**Ko-SBERT** 등)을 활용하여 '통합 텍스트'를 고차원 벡터(768차원 등)로 변환
- **가격대 범주화 방식 논의 필요**
- **결측치(Null):** 동적 가중치 방식으로 처리 (값이 없는 속성은 유사도 계산에서 자동 제외)
- **시즌 그룹핑:** Non-Season=정확일치, Fall↔Winter(FW), Spring↔Summer(SS)
- **성별 매칭:** UNISEX는 남성/여성 모두와 매칭 허용

---

## 3. 알고리즘 및 로직 정의

### 3.1 프로세스 흐름 (Flow)

**[하드필터링] → [Vector Retrieval] → [Re-ranking]** 3단계 구조

```
┌─────────────────────────────────────────────────────────────┐
│  1. 하드필터링                                               │
│     PRDT_KIND_NM + SEX_NM + SESN_SUB_NM 조건 일치 상품 추출   │
├─────────────────────────────────────────────────────────────┤
│  2. 공통 속성 유사도 계산                                     │
│     ITEM_NM_ENG, SUB_CAT_NM, TAG_PRICE, PRDT_NM             │
├─────────────────────────────────────────────────────────────┤
│  3. 대분류별 분기 (PARENT_PRDT_KIND_NM)                      │
│     ├─ 의류: FAB_TYPE_NM, FIT_INFO1, DOMAIN1_NM 등          │
│     └─ ACC: SHAPE1_USR, SESN_USR, FIT_INFO1 등              │
├─────────────────────────────────────────────────────────────┤
│  4. 동적 가중치 정규화                                       │
│     사용된 속성의 가중치 합으로 재정규화                       │
├─────────────────────────────────────────────────────────────┤
│  5. Ranking → Top 3 추출                                    │
└─────────────────────────────────────────────────────────────┘

```

### 3.2 하드필터링 조건

| 필터 조건 | 매칭 규칙 | 예시 |
| --- | --- | --- |
| `PRDT_KIND_NM` | 완전 일치 | Inner = Inner만 매칭 |
| `SEX_NM` | 일치 + UNISEX 예외 | 공용↔남성 OK, 공용↔여성 OK |
| `SESN_SUB_NM` | 시즌 그룹 매칭 | Fall↔Winter OK, Non-Season=정확일치 |

### 3.3 동적 가중치 계산 방식

두 상품 비교 시, **양쪽 모두 값이 존재하는 속성만** 계산에 포함하고 사용된 속성들의 가중치 합으로 재정규화하여 최종 점수를 산출함.

```jsx
Score_rule = Σ(속성 유사도 × 가중치) / Σ(사용된 가중치)
```

- **속성 유사도**: 속성별 특성에 따라 0.0 ~ 1.0 사이 값 산출
- **동적 가중치**: 양쪽 모두 값이 존재하는 속성만 계산에 포함, 재정규화

**속성별 유사도 계산 방식:**

| 유형 | 방식 | 예시 |
| --- | --- | --- |
| **텍스트 유사도** | 공통 단어/형태소 기반 | ITEM_NM_ENG, FIT_INFO1, SESN_USR 등 |
| **연속형** | 값 차이 기반 유사도 | TAG_PRICE: 가격 차이 비율 |
| **Exact Match** | 완전일치만 점수 | DOMAIN1_NM: 같으면 1.0, 다르면 0.0 |

> ※ 속성별 상세 유사도 계산 규칙은 피쳐 정의서 참조
> 

## 4. 출력 데이터

---

### 4.1 반환 결과 및 저장방식

- 각 상품 기준으로 유사한 과거 상품 Top 3를 DB 테이블 형태로 사전 계산하여 저장
- 반환 항목: 기준상품 ID, 유사상품 ID(1~3위), 유사도 점수, 매칭된 속성 수

### 4.2 비기능 요구사항

- 배치 주기: 일 1회 또는 신규 상품 등록 시
- 최소 매칭 속성 수: 3개 이상 (미달 시 "비교 불가" 처리 검토)

---

## 5. 프로젝트 일정 (Milestone)

**Phase 1. 속성 기반 모델링 (총 6주)**

| **주차** | **기간** | **단계** | **주요 내용** |
| --- | --- | --- | --- |
| **Week 1** | 1/20 ~ 1/24 | 환경 구축 | 데이터 수집 및 전처리, 라이브러리(Torch, Transformers) 설치 |
| **Week 2** | 1/27 ~ 1/31 | **모델 선정** | Ko-SBERT 등 한국어 임베딩 모델 테스트 및 선정 |
| **Week 3** | 2/03 ~ 2/07 | 벡터화 | 전체 상품 텍스트 벡터 변환 및 인덱싱 |
| **Week 4** | 2/10 ~ 2/14 | 로직 구현 | Hard Filter + Retrieval + Re-ranking 결합 개발 |
| **Week 5** | 2/17 ~ 2/21 | 튜닝/검증 | 가중치(Alpha) 조절 및 정성 평가 (현업 피드백) |
| **Week 6** | 2/24 ~ 2/28 | 이관/배포 | 배치 스케줄러 등록 및 운영 이관 |

---

## Appendix. 브랜드별 속성 가용성

### A.1 현황 : 25F, 25N, 25S

브랜드별 주요 속성 빈값률 분석 결과, 입력률 차이가 상당히 큼.

| 속성 | MLB(M) | DX(X) | ST | V | 기타 |
| --- | --- | --- | --- | --- | --- |
| FIT_INFO1 | ✅ 0% | ✅ 3% | ✅ 1% | ⚠️ 63% | ~25% |
| DOMAIN1_NM | ✅ 0% | ✅ 0% | ✅ 0% | ✅ 0% | 0% |
| SHAPE1_USR | ✅ 25% | ❌ 100% | ❌ 94% | ❌ 100% | 100% |
| SESN_USR | ✅ 9% | ❌ 100% | ❌ 100% | ❌ 100% | 100% |

> ※ 빈값률 수치는 현재 데이터 기준이며, 추후 변동 가능
> 

### A.2 동적 가중치 방식 도입 배경

| 구분 | 내용 |
| --- | --- |
| **이슈** | MLB는 속성 풍부, 타 브랜드는 NULL 많음 → 제외하기 아쉬움 |
| **의사결정** | 전 브랜드 통합 목적 + 채워진 속성 최대 활용 → 동적 가중치 방식 |
| **기대효과** | MLB는 정밀 분석, 타 브랜드도 유의미한 결과, 향후 확장성 |